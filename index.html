<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription et Connexion</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to your CSS file -->
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "firebase/app";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "firebase/auth";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "firebase/firestore";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDC7a1EgO3tRWsb4_ywFnzcsjJ_7S7UtaU",
            authDomain: "gestionutilisateur-3f8e6.firebaseapp.com",
            projectId: "gestionutilisateur-3f8e6",
            storageBucket: "gestionutilisateur-3f8e6.appspot.com",
            messagingSenderId: "872127075871",
            appId: "1:872127075871:web:1b44316d800ddf2cf8e72a",
            measurementId: "G-HM68M5YWEY"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Function to check if email exists
        const checkEmailExists = async (email) => {
            const usersRef = collection(db, "users");
            const q = query(usersRef, where("email", "==", email));
            const querySnapshot = await getDocs(q);
            return !querySnapshot.empty; // Returns true if the email exists
        };

        // Function to add user
        const addUser = async (username, email, password) => {
            try {
                // Create a new user
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Add user to Firestore
                await addDoc(collection(db, 'users'), {
                    username: username,
                    email: email,
                    uid: user.uid
                });

                document.getElementById("message").textContent = "Utilisateur inscrit avec succès !";
            } catch (error) {
                document.getElementById("message").textContent = "Erreur : " + error.message;
            }
        };

        // Show the registration form
        const showRegisterForm = () => {
            document.getElementById("registerForm").style.display = "block";
            document.getElementById("loginForm").style.display = "none";
        };

        // Show the login form
        const showLoginForm = () => {
            document.getElementById("registerForm").style.display = "none";
            document.getElementById("loginForm").style.display = "block";
        };

        // Registration form handling
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("registerForm").addEventListener("submit", async (event) => {
                event.preventDefault(); // Prevent page reload

                const username = document.getElementById("username").value;
                const email = document.getElementById("email").value;
                const password = document.getElementById("password").value;

                const emailExists = await checkEmailExists(email);
                if (emailExists) {
                    document.getElementById("message").textContent = "Cet email est déjà utilisé.";
                    return;
                }

                await addUser(username, email, password);
            });

            // Login form handling
            document.getElementById("loginForm").addEventListener("submit", async (event) => {
                event.preventDefault(); // Prevent page reload

                const email = document.getElementById("loginEmail").value;
                const password = document.getElementById("loginPassword").value;

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    document.getElementById("loginMessage").textContent = "Connexion réussie!";
                } catch (error) {
                    document.getElementById("loginMessage").textContent = "Identifiants invalides.";
                }
            });

            // Toggle between login and registration forms
            document.getElementById("showLogin").addEventListener("click", function(event) {
                event.preventDefault();
                showLoginForm();
            });

            document.getElementById("showRegister").addEventListener("click", function(event) {
                event.preventDefault();
                showRegisterForm();
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Inscription</h1>
        <form id="registerForm">
            <label for="username">Nom d'utilisateur</label>
            <input type="text" id="username" placeholder="Nom d'utilisateur" required>
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Email" required>
            <label for="password">Mot de passe</label>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <button type="submit">S'inscrire</button>
            <p id="message"></p>
        </form>

        <p>Vous avez déjà un compte? <a href="#" id="showLogin">Connectez-vous ici</a></p>

        <h1>Connexion</h1>
        <form id="loginForm" style="display: none;">
            <label for="loginEmail">Email</label>
            <input type="email" id="loginEmail" placeholder="Email" required>
            <label for="loginPassword">Mot de passe</label>
            <input type="password" id="loginPassword" placeholder="Mot de passe" required>
            <button type="submit">Se connecter</button>
            <p id="loginMessage"></p>
        </form>

        <p>Vous n'avez pas de compte? <a href="#" id="showRegister">Créez-en un</a></p>
    </div>
</body>
</html>
